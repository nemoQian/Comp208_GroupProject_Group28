Index: src/main/java/com/group28/controller/Ajaxcontroller.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.group28.controller;\r\nimport com.group28.service.UserServiceImpl;\r\nimport org.springframework.stereotype.Controller;\r\nimport org.springframework.web.bind.annotation.PostMapping;\r\nimport org.springframework.web.bind.annotation.RequestMapping;\r\nimport org.springframework.web.bind.annotation.RequestParam;\r\nimport org.springframework.web.bind.annotation.RestController;\r\nimport java.util.ArrayList;\r\nimport java.util.Map;\r\nimport com.group28.controller.Position;\r\nimport com.group28.controller.line;\r\n@Controller\r\n@RestController\r\n@RequestMapping(\"/ajax\")\r\npublic class Ajaxcontroller {\r\n\r\n\r\n    private UserServiceImpl userService;\r\n    ArrayList <Position> positionArrayList= new ArrayList();\r\n    ArrayList <line> lineArrayList= new ArrayList();\r\n\r\n    @PostMapping(\"/login\")\r\n    public  String getluser(@RequestParam(value = \"Username\",required = false) String username,\r\n                           @RequestParam(value = \"password\",required = false) String password){\r\n        userService = new UserServiceImpl();\r\n        String statCode = userService.login(username, password);\r\n        System.out.println(\"username = \"  + username);\r\n        System.out.println(\"password = \"  + password);\r\n        System.out.println(statCode);\r\n\r\n\r\n        return statCode;\r\n    }\r\n\r\n    @RequestMapping(\"/register\")\r\n    public String getruser(@RequestParam(value = \"Username\",required = false) String username,\r\n                           @RequestParam(value = \"password\",required = false) String password,\r\n                            @RequestParam(value = \"email\",required = false) String email){\r\n        userService = new UserServiceImpl();\r\n        String statCode = userService.Register(username, password,email);\r\n        System.out.println(\"username = \"  + username);\r\n        System.out.println(\"password = \"  + password);\r\n        System.out.println(\"email = \" + email);\r\n        System.out.println(statCode);\r\n\r\n        return statCode;\r\n    }\r\n    @RequestMapping(\"/position\")\r\n    public void getposition(@RequestParam(value = \"type\",required = false) String type,\r\n                            @RequestParam(value = \"name\",required = false) String name,\r\n                            @RequestParam(value = \"x\",required = false) int x,\r\n                            @RequestParam(value = \"y\",required = false) int y,\r\n                            @RequestParam(value = \"consumption\",required = false) String consumption){\r\n\r\n\r\n        Position position = new Position(type,name,x,y,consumption);\r\n        positionArrayList.add(position);\r\n        System.out.println(\"add\");\r\n        printarray(positionArrayList);\r\n\r\n    }\r\n\r\n    @RequestMapping(\"/reset\")\r\n    public void reset(){\r\n\r\n            positionArrayList.clear();\r\n\r\n        System.out.println(\"reset\");\r\n    }\r\n\r\n    @RequestMapping(\"/rollback\")\r\n    public void rollback(){\r\n        positionArrayList.remove(positionArrayList.size()-1);\r\n\r\n        System.out.println(\"rollbcak\");\r\n        printarray(positionArrayList);\r\n    }\r\n\r\n    @RequestMapping(\"/done\")\r\n    public int[] drawline(){\r\n         int array[] =new int []{0,0,100,200,100,200,400,150};\r\n        return array;\r\n    }\r\n\r\n    public void printarray(ArrayList<Position> pa){\r\n        Position P =  new Position();\r\n        for (int i = 0; i < pa.size(); i++) {\r\n            System.out.print(\" \"+i+\" \");\r\n            P.printp(pa.get(i));\r\n        }\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/group28/controller/Ajaxcontroller.java b/src/main/java/com/group28/controller/Ajaxcontroller.java
--- a/src/main/java/com/group28/controller/Ajaxcontroller.java	
+++ b/src/main/java/com/group28/controller/Ajaxcontroller.java	
@@ -1,4 +1,5 @@
 package com.group28.controller;
+import com.group28.service.Interation;
 import com.group28.service.UserServiceImpl;
 import org.springframework.stereotype.Controller;
 import org.springframework.web.bind.annotation.PostMapping;
@@ -19,6 +20,8 @@
     ArrayList <Position> positionArrayList= new ArrayList();
     ArrayList <line> lineArrayList= new ArrayList();
 
+    private Interation interation = new Interation();
+
     @PostMapping("/login")
     public  String getluser(@RequestParam(value = "Username",required = false) String username,
                            @RequestParam(value = "password",required = false) String password){
Index: src/main/java/com/group28/service/Interation.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.group28.service;\r\n\r\nimport com.group28.dao.ElectricityUnitDao;\r\nimport com.group28.dao.PowerStationDao;\r\nimport com.group28.pojo.*;\r\nimport com.group28.util.MyBatisUtil;\r\nimport com.group28.util.SimulateVirtualWorld;\r\nimport org.apache.ibatis.session.SqlSession;\r\n\r\nimport java.util.List;\r\n\r\npublic class Interation implements IntegrationInterface{\r\n\r\n    private final int FAIL = -1;\r\n    private final int SUCCESS = 1;\r\n    private final int ROW = 0;\r\n    private final int COL = 1;\r\n\r\n    private int state = 0;\r\n\r\n    private final String[] electricityUnitTypeName = {\"Community\", \"Hospital\", \"ShoppingMall\", \"School\"};\r\n    private final String powerStationTypeName = \"PowerStation\";\r\n\r\n    private ElectricityUnit electricityUnit;\r\n    private PowerStation powerStation;\r\n    private FacilityData facilityData;\r\n\r\n    private int numberOfPowerStation = 0;\r\n    private int numberOfElectricity = 0;\r\n\r\n    private SimulateVirtualWorld virtualWorld;\r\n\r\n    public Interation(){\r\n\r\n    }\r\n\r\n    @Override\r\n    public int worldSimulationOpen(){\r\n        resetDB();\r\n        virtualWorld = new SimulateVirtualWorld();\r\n        if(virtualWorld.judgement()){\r\n            virtualWorld.worldSimulateOpen();\r\n            return SUCCESS;\r\n        }\r\n        else { return FAIL; }\r\n    }\r\n\r\n    @Override\r\n    public int worldSimulationReset() {\r\n        virtualWorld.worldSimulateStop();\r\n        return SUCCESS;\r\n    }\r\n\r\n    private void resetDB(){\r\n        SqlSession sqlSession = MyBatisUtil.getSqlSession();\r\n        PowerStationDao mapper1 = sqlSession.getMapper(PowerStationDao.class);\r\n        List<String> powerStationList = mapper1.GetStationList();\r\n        for(String id : powerStationList){\r\n            mapper1.DeleteStation(id);\r\n        }\r\n        sqlSession.commit();\r\n\r\n        ElectricityUnitDao mapper2 = sqlSession.getMapper(ElectricityUnitDao.class);\r\n        List<String> electricityUnitList = mapper2.GetUnitIdList();\r\n        for (String id : electricityUnitList) {\r\n            mapper2.DeleteElectricityUnit(id);\r\n        }\r\n        sqlSession.commit();\r\n        sqlSession.close();\r\n    }\r\n\r\n    @Override\r\n    public int addNewFacility(String facilityType, String facilityName, int locationX, int locationY, String facilityLevel) {\r\n        SqlSession sqlSession = MyBatisUtil.getSqlSession();\r\n        int[] location = {locationX / 100, locationY / 100};\r\n\r\n        if (facilityType == powerStationTypeName){\r\n            PowerStationDao mapper = sqlSession.getMapper(PowerStationDao.class);\r\n            if(mapper.findPowerStation(facilityName) == null){\r\n                generatePowerStation(facilityName,facilityLevel,location[ROW],location[COL]);\r\n                facilityData = new FacilityData(powerStation, mapper.findPowerStationType(facilityLevel));\r\n                state =  virtualWorld.addNewFacility(facilityData, location);\r\n                if(state == 1){\r\n                    mapper.AddStation(powerStation);\r\n                    sqlSession.commit();\r\n                    sqlSession.close();\r\n                    return SUCCESS;\r\n                }\r\n                else {\r\n                    sqlSession.close();\r\n                    return FAIL;\r\n                }\r\n            }\r\n            else {\r\n                sqlSession.close();\r\n                return FAIL;\r\n            }\r\n        }\r\n        else if (facilityType == electricityUnitTypeName[0] || facilityType == electricityUnitTypeName[1] ||\r\n                 facilityType == electricityUnitTypeName[2] || facilityType == electricityUnitTypeName[3]){\r\n            ElectricityUnitDao mapper = sqlSession.getMapper(ElectricityUnitDao.class);\r\n            if(mapper.findElectricityUnit(facilityName) == null){\r\n                generateElectricityUnit(facilityName,facilityLevel,location[ROW],location[COL]);\r\n                facilityData = new FacilityData(electricityUnit, mapper.findElectricityUnitType(facilityLevel));\r\n                state =  virtualWorld.addNewFacility(facilityData, location);\r\n                if(state == 1){\r\n                    mapper.AddFacility(electricityUnit);\r\n                    sqlSession.commit();\r\n                    sqlSession.close();\r\n                    return SUCCESS;\r\n                }\r\n                else {\r\n                    sqlSession.close();\r\n                    return FAIL;\r\n                }\r\n            }\r\n            else {\r\n                sqlSession.close();\r\n                return FAIL;\r\n            }\r\n        }\r\n        else { return FAIL; }\r\n    }\r\n\r\n    @Override\r\n    public int getTotalConsumption() {\r\n        return virtualWorld.getTotalConsumption();\r\n    }\r\n\r\n    @Override\r\n    public int getTotalProduction() {\r\n        return virtualWorld.getTotalProduction();\r\n    }\r\n\r\n    @Override\r\n    public int getElectricityUnitConsumption(String electricityUnitName) {\r\n        return 0;\r\n    }\r\n\r\n    @Override\r\n    public int getPowerStationProduction(String powerStationName) {\r\n        return 0;\r\n    }\r\n\r\n    @Override\r\n    public int getTypicalTypeConsumption(String electricityUnitType) {\r\n        return 0;\r\n    }\r\n\r\n    @Override\r\n    public int getRateOfTypicalType(String electricityUnitType) {\r\n        return 0;\r\n    }\r\n\r\n    private String generateZipCode(int x, int y) {\r\n        if(x < 10){\r\n            if( y < 10){\r\n                return \"S0\" + x + \" A0\" + y;\r\n            }\r\n            else { return \"S0\" + x + \" A\" + y; }\r\n        }\r\n        else {\r\n            if (y < 10) {\r\n                return \"S\" + x + \" A0\" + y;\r\n            } else {\r\n                return \"S\" + x + \" A\" + y;\r\n            }\r\n        }\r\n    }\r\n\r\n    private String generateId(String powerStationType, int x, int y){\r\n        if(x < 10){\r\n            if( y < 10){\r\n                return powerStationType + \"S0\" + x + \"A0\" + y;\r\n            }\r\n            else { return powerStationType + \"S0\" + x + \"A\" + y; }\r\n        }\r\n        else {\r\n            if (y < 10) {\r\n                return powerStationType + \"S\" + x + \"A0\" + y;\r\n            } else {\r\n                return powerStationType + \"S\" + x + \"A\" + y;\r\n            }\r\n        }\r\n    }\r\n\r\n    private void generatePowerStation(String powerStationName, String powerStationType, int x, int y){\r\n        powerStation = new PowerStation();\r\n        powerStation.Put_powerStationId(generateId(powerStationType,x,y));\r\n        powerStation.Put_zipCode(generateZipCode(x,y));\r\n        powerStation.Put_powerStationType(powerStationType);\r\n        powerStation.Put_powerStationName(powerStationName);\r\n    }\r\n\r\n    private void generateElectricityUnit(String electricityUnitName, String electricityUnitType, int x, int y){\r\n        electricityUnit = new ElectricityUnit();\r\n        electricityUnit.Put_electricityUnitId(generateId(electricityUnitType,x,y));\r\n        electricityUnit.Put_zipCode(generateZipCode(x,y));\r\n        electricityUnit.Put_electricityUnitType(electricityUnitType);\r\n        electricityUnit.Put_electricityUnitName(electricityUnitName);\r\n    }\r\n\r\n    public int[] prim(){\r\n        return virtualWorld.prim();\r\n    }\r\n\r\n    public int getLose(){\r\n        return virtualWorld.getTotalLose();\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/group28/service/Interation.java b/src/main/java/com/group28/service/Interation.java
--- a/src/main/java/com/group28/service/Interation.java	
+++ b/src/main/java/com/group28/service/Interation.java	
@@ -31,7 +31,8 @@
     private SimulateVirtualWorld virtualWorld;
 
     public Interation(){
-
+        resetDB();
+        virtualWorld = new SimulateVirtualWorld();
     }
 
     @Override
@@ -72,7 +73,7 @@
     @Override
     public int addNewFacility(String facilityType, String facilityName, int locationX, int locationY, String facilityLevel) {
         SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        int[] location = {locationX / 100, locationY / 100};
+        int[] location = {locationX, locationY};
 
         if (facilityType == powerStationTypeName){
             PowerStationDao mapper = sqlSession.getMapper(PowerStationDao.class);
Index: src/main/java/com/group28/util/SimulateVirtualWorldInterface.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.group28.util;\r\n\r\nimport com.group28.pojo.Facility;\r\nimport com.group28.pojo.FacilityData;\r\n\r\npublic interface SimulateVirtualWorldInterface {\r\n\r\n    void worldSimulateOpen ();\r\n\r\n    void worldSimulateStop ();\r\n\r\n    int addNewFacility (FacilityData facilityData, int[] location);\r\n\r\n    long getTotalProduction ();\r\n\r\n    long getTotalConsumption ();\r\n\r\n    long getMaxConsumption();\r\n\r\n    long getFacilityConsumption (Facility facility);\r\n\r\n    int getTotalLose ();\r\n\r\n    int getNumOfFacility ();\r\n\r\n    int getNumOfPowerStation ();\r\n\r\n    int getNumOfElectricityUnit ();\r\n\r\n    String getFrontReferenceId (Facility facility);\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/com/group28/util/SimulateVirtualWorldInterface.java b/src/main/java/com/group28/util/SimulateVirtualWorldInterface.java
--- a/src/main/java/com/group28/util/SimulateVirtualWorldInterface.java	
+++ b/src/main/java/com/group28/util/SimulateVirtualWorldInterface.java	
@@ -11,13 +11,13 @@
 
     int addNewFacility (FacilityData facilityData, int[] location);
 
-    long getTotalProduction ();
+    int getTotalProduction ();
 
-    long getTotalConsumption ();
+    int getTotalConsumption ();
 
-    long getMaxConsumption();
+    int getMaxConsumption();
 
-    long getFacilityConsumption (Facility facility);
+    int getFacilityConsumption (Facility facility);
 
     int getTotalLose ();
 
Index: web/WEB-INF/jsp/home page/menu.jsp
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %>\r\n\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n\r\n\t<meta charset=\"utf-8\">\r\n\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n\t<title>homepage</title>\r\n\t<link rel=\"shortcut icon\" href=\"picture/28logo.png\">\r\n\t<link rel=\"stylesheet\" href=\"./reset/reset.css\">\r\n\t<link rel=\"stylesheet\" type=\"text/css\" href=\"./menu.css\">\r\n\t<script src=\"https://cdn.staticfile.org/vue/2.6.9/vue.js\"></script>\r\n\t<script src=\"https://unpkg.com/http-vue-loader\"></script>\r\n\t<script src=\"js/echarts.min.js\"></script>\r\n\t<script src=\"js/jquery-2.2.1.min.js\"></script>\r\n\t<script src=\"js/echarts.helper.js\"></script>\r\n\t<script src=\"chart_js/chart_1.js\"></script>\r\n\t<script src=\"chart_js/chart_2.js\"></script>\r\n\t<script src=\"chart_js/chart_3.js\"></script>\r\n\t<script src=\"chart_js/chart_5.js\"></script>\r\n\t<script src=\"https://unpkg.com/axios/dist/axios.min.js\"></script>\r\n</head>\r\n<style>\r\n\r\n</style>\r\n<body>\r\n\r\n<header>\r\n\t<img src=\"picture/28logo.png\" width=25px height=25px class=\"logo\">\r\n\t<img src=\"picture/download.png\" width=25px height=25px class=\"download\">\r\n\t<img src=\"picture/user.png\" width=25px height=25px class=\"user\">\r\n\t<img src=\"picture/exit.png\" width=25px height=25px class=\"exit\">\r\n\r\n\t<div class=\"title\">City energy management and Computational Sustainability System</div>\r\n\t<div class=\"user\"></div>\r\n</header>\r\n<div class=\"boxset\">\r\n\t<div class=\"box1\">\r\n\t\t<div class=\"box1_header\">Power scatter diagram of electric facilities</div>\r\n\t\t<div id=\"chart_3\" class=\"test2\" style=\"width: 340px; height: 290px;\"></div>\r\n\r\n\r\n\t</div>\r\n\r\n\r\n\t<div class=\"box2_header\">Map</div>\r\n\t<div class=\"box2\">\r\n\r\n\t\t<canvas width=\"829px\" height=\"515px\" id=\"myCanvas\"></canvas>\r\n\r\n\r\n\t</div>\r\n\r\n\r\n\t<div class=\"box3\">\r\n\t\t<div class=\"box3_header\">Power generation and consumption</div>\r\n\t\t<div id=\"chart_2\" class=\"test\" style=\"width: 100%; height: 190px;\"></div>\r\n\t</div>\r\n\t<div class=\"box4\">\r\n\t\t<div class=\"box4_header\">Facilities number and consumption</div>\r\n\t\t<div id=\"chart_4\" class=\"test1\" style=\"width: 100%;height:270px;\"></div>\r\n\t</div>\r\n\t<div id='app' class=\"container\">\r\n\t\t<div class=\"box5\">\r\n\t\t\t<div class=\"box5_header\">Add and modify facilities </div>\r\n\t\t\t<div class=\"select\">\r\n\t\t\t\t<div class=\"raselect\">\r\n\t\t\t\t\t<img src=\"picture/house.png\" class=\"house\" width=\"50px\"  v-bind:title=\"messagehouse\"><br><br>\r\n\t\t\t\t\t<input type=\"radio\" name=\"type\" id=\"house\" value=\"Community\" v-model=\"stype\"> Community\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"hosselect\">\r\n\t\t\t\t\t<img src=\"picture/hospital.png\" class=\"hospital\" width=\"50px\"  v-bind:title=\"messagehospital\"><br><br>\r\n\t\t\t\t\t<input type=\"radio\" name=\"type\" id=\"Hospital\"  value=\"Hospital\" v-model=\"stype\"> Hospital\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"schoolselect\">\r\n\t\t\t\t\t<img src=\"picture/school.png\" class=\"school\" width=\"60px\"  v-bind:title=\"messageschool\"><br><br>\r\n\t\t\t\t\t<input type=\"radio\" name=\"type\" id=\"school\" value=\"School\"  v-model=\"stype\"> School\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"powerselect\">\r\n\t\t\t\t\t<img src=\"picture/power%20station.png\" class=\"power\" width=\"60px\"  v-bind:title=\"messagepower\"><br><br>\r\n\t\t\t\t\t<input type=\"radio\"  name=\"type\" id=\"power\" value=\" Power station\" v-model=\"stype\"> Power station\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"shopselect\">\r\n\t\t\t\t\t<img src=\"picture/shopping%20centre.png\" class=\"shop\" width=\"50px\"  v-bind:title=\"messageshop\"><br><br>\r\n\t\t\t\t\t<input type=\"radio\" name=\"type\" id=\"shop\"  value=\"Shopping centre\" v-model=\"stype\"> Shopping <br>&nbsp&nbsp&nbsp&nbsp&nbsp&nbspcentre\r\n\t\t\t\t</div>\r\n\r\n\r\n\t\t\t</div>\r\n\t\t\t<div class='operation' >\r\n\t\t\t\t<!--style=\"border-left:1px solid #d3d3d3;\"-->\r\n\t\t\t\t<div class=\"input\"><label >Name: &nbsp</label><input class=\"inputname\" v-model='name' /></div>\r\n\r\n\t\t\t\t<div class=\"input\"><label >X-coordinate: &nbsp</label><input class=\"inputx\" v-model='x' type=\"text\"   /></div>\r\n\r\n\t\t\t\t<div class=\"input\"><label >Y-coordinate: &nbsp</label><input class=\"inputy\" v-model='y' type=\"text\"  /></div>\r\n\r\n\t\t\t\tPower level:\r\n\t\t\t\t<select class=\"consumption\" v-model=\"consumption\" >\r\n\r\n\r\n\r\n\t\t\t\t\t<option>low-level</option>\r\n\r\n\t\t\t\t\t<option>medium-level</option>\r\n\r\n\t\t\t\t\t<option>high-level</option>\r\n\r\n\t\t\t\t</select>\r\n\r\n\t\t\t\t<button class=\"add\" type=\"submit\" @click=\"addsubmit\"> add </button>\r\n\t\t\t\t<button class=\"reset\" type=\"submit\" @click=\"clearCanvas\"> reset </button>\r\n\t\t\t\t<button class=\"done\" type=\"submit\"  @click=\"done\"  > done </button>\r\n\t\t\t\t<button class=\"rollback\" type=\"submit\"  @click=\"rollback\"> rollback </button>\r\n\r\n\t\t\t</div>\r\n\r\n\t\t</div>\r\n\t</div>\r\n\r\n\r\n\t<div class=\"box6\">\r\n\t\t<div class=\"box6_header\">Energymonitor</div>\r\n\t\t<div id=\"chart_5\" class=\"test3\" style=\"width: 1320px;height:350px;\"></div>\r\n\r\n\t</div>\r\n\r\n</div>\r\n\r\n</body>\r\n<script src=\"https://unpkg.com/axios/dist/axios.min.js\"></script>\r\n<script src=\"https://cdn.bootcdn.net/ajax/libs/qs/6.9.4/qs.min.js\"></script>\r\n<script type=\"text/javascript\">\r\n\r\n\tvar canvas=document.getElementById('myCanvas');\r\n\tvar ctx=canvas.getContext('2d');\r\n\tvar imagedata = ctx.getImageData(0,0,829,515);\r\n\tarray=[]\r\n\tarray.push(imagedata)\r\n\r\n\tfunction draw(fromx,fromy,tox,toy){\r\n\t\tctx.moveTo(fromx,fromy);\r\n\t\tctx.lineTo(tox,toy);\r\n\t\tctx.stroke();\r\n\t}\r\n\r\n\r\n\r\n\r\n\tfunction communityposition(x,y){\r\n\t\tvar img = new Image()\r\n\t\timg.src = 'picture/house.png'\r\n\t\timg.onload = function(){\r\n\t\t\tctx.drawImage(this,x, y, 50, 45)\r\n\t\t\timagedata = ctx.getImageData(0,0,829,515)\r\n\t\t\tarray.push(imagedata)\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\t}\r\n\r\n\tfunction houspitalposition(x,y){\r\n\t\tvar img = new Image()\r\n\t\timg.src = 'picture/hospital.png'\r\n\t\timg.onload = function(){\r\n\t\t\tctx.drawImage(this,x, y, 50, 50)\r\n\t\t\timagedata = ctx.getImageData(0,0,829,515)\r\n\t\t\tarray.push(imagedata)\r\n\t\t}\r\n\r\n\r\n\t}\r\n\tfunction shopposition(x,y){\r\n\t\tvar img = new Image()\r\n\t\timg.src = 'picture/shopping centre.png'\r\n\t\timg.onload = function(){\r\n\t\t\tctx.drawImage(this,x, y, 50, 50)\r\n\t\t\timagedata = ctx.getImageData(0,0,829,515)\r\n\t\t\tarray.push(imagedata)\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tfunction schoolposition(x,y){\r\n\t\tvar img = new Image()\r\n\t\timg.src = 'picture/school.png'\r\n\t\timg.onload = function(){\r\n\t\t\tctx.drawImage(this,x, y, 50, 50)\r\n\t\t\timagedata = ctx.getImageData(0,0,829,515)\r\n\t\t\tarray.push(imagedata)\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tfunction powerposition(x,y){\r\n\t\tvar img = new Image()\r\n\t\timg.src = 'picture/power station.png'\r\n\t\timg.onload = function(){\r\n\t\t\tctx.drawImage(this,x, y, 60, 60)\r\n\t\t\timagedata = ctx.getImageData(0,0,829,515)\r\n\t\t\tarray.push(imagedata)\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\r\n\r\n\r\n\tfunction isNumber(str){\r\n\t\tvar n = Number(str);\r\n\t\tif (!isNaN(n)){\r\n\t\t\treturn true;\r\n\t\t}else{\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\r\n\tvar vue = new Vue({\r\n\t\tel: '#app',\r\n\t\tdata: {\r\n\t\t\tx:\"\",y:\"\",name:\"\",consumption:\"\",stype:\"\",array:[],imagedata,\r\n\r\n\t\t\tmessagehouse:\"low-level: medium-level: high-level: \",\r\n\t\t\tmessagehospital:\"low-level: medium-level: high-level: \",\r\n\t\t\tmessageschool:\"low-level: medium-level: high-level: \",\r\n\t\t\tmessagepower:\"low-level: medium-level: high-level: \",\r\n\t\t\tmessageshop:\"low-level: medium-level: high-level: \",\r\n\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n\r\n\r\n\r\n\t\t\taddword:function(){\r\n\t\t\t\tvar len = this.name.length;\r\n\t\t\t\tvar con=document.getElementById(\"myCanvas\");\r\n\t\t\t\tvar context=con.getContext(\"2d\");\r\n\t\t\t\tcontext.font = 'italic 16px Calibri';\r\n\t\t\t\tcontext.fillText(this.name,(Number(this.x)*2+50)/2-4.5*len,Number(this.y)+68)\r\n\t\t\t},\r\n\r\n\r\n\r\n\t\t\taddsubmit:function(){\r\n\t\t\t\tvar type = this.stype;\r\n\t\t\t\tvar x = this.x;\r\n\t\t\t\tvar y = this.y;\r\n\r\n\r\n\t\t\t\tif(isNumber(x)==false||isNumber(y)==false){alert(\"Please input the number.\")}\r\n\r\n\r\n\r\n\t\t\t\tif(type==\"\"){alert(\"Please choose the type first.\")}\r\n\t\t\t\telse if(x==\"\"){alert(\"Please enter the value of x.\")}\r\n\t\t\t\telse if(y==\"\"){alert(\"Please enter the value of y.\")}\r\n\t\t\t\telse if (this.consumption==\"\"){alert(\"Please choose the consumption level.\")}\r\n\t\t\t\telse if(type==\"Community\"){\r\n\t\t\t\t\tcommunityposition(x,y)\r\n\t\t\t\t\tthis.addword()\r\n\t\t\t\t}\r\n\t\t\t\telse if(type==\"Shopping centre\"){\r\n\t\t\t\t\tshopposition(x,y)\r\n\t\t\t\t\tthis.addword(x,y)\r\n\t\t\t\t}else if(type==\"Hospital\"){\r\n\t\t\t\t\thouspitalposition(x,y)\r\n\t\t\t\t\tthis.addword(x,y)\r\n\t\t\t\t}else if(type==\"School\"){\r\n\t\t\t\t\tschoolposition(x,y)\r\n\t\t\t\t\tthis.addword(x,y)\r\n\t\t\t\t}else {\r\n\t\t\t\t\tpowerposition(x,y)\r\n\t\t\t\t\tthis.addword(x,y)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet p = window.Qs.stringify(\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype:this.stype,\r\n\t\t\t\t\t\t\tname:this.name,\r\n\t\t\t\t\t\t\tx:this.x,\r\n\t\t\t\t\t\t\ty:this.y,\r\n\t\t\t\t\t\t\tconsumption:this.consumption,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tconsole.log(p)\r\n\t\t\t\taxios.post('ajax/position',p)\r\n\r\n\r\n\t\t\t},\r\n\r\n\r\n\t\t\tclearCanvas:function (){\r\n\t\t\t\tvar c=document.getElementById(\"myCanvas\");\r\n\t\t\t\tvar cxt=c.getContext(\"2d\");\r\n\t\t\t\tcxt.clearRect(0,0,c.width,c.height);\r\n\r\n\t\t\t\taxios.post('ajax/reset')\r\n\t\t\t},\r\n\r\n            rollback:function (){\r\n\t\t\t\tif(array.length==1) {\r\n\t\t\t\t\talert(\"There is no previous operation.\")\r\n\t\t\t\t}else{\r\n\t\t\t\t\tarray.pop()\r\n\t\t\t\t\tctx.putImageData(array[array.length - 1], 0, 0);\r\n\t\t\t\t\taxios.post('ajax/rollback')\r\n\t\t\t\t}\r\n\t\t\t},\r\n\r\n\t\t\tdone:function (){\r\n\r\n\t\t\t\taxios.post('ajax/done').then(function (res) {\r\n\r\n\t\t\t\t\tconsole.log(res.data)\r\n\t\t\t\t\tfor (let i = 0; i < res.data.length; i+=4) {\r\n\r\n\t\t\t\t\t\tdraw(res.data[i],res.data[i+1],res.data[i+2],res.data[i+3])\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\r\n\r\n</script>\r\n\r\n</html>\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/web/WEB-INF/jsp/home page/menu.jsp b/web/WEB-INF/jsp/home page/menu.jsp
--- a/web/WEB-INF/jsp/home page/menu.jsp	
+++ b/web/WEB-INF/jsp/home page/menu.jsp	
@@ -290,8 +290,8 @@
 						{
 							type:this.stype,
 							name:this.name,
-							x:this.x,
-							y:this.y,
+							x:this.x/100,
+							y:this.y/100,
 							consumption:this.consumption,
 						}
 				);
Index: out/artifacts/Project_war_exploded/WEB-INF/classes/db.properties
===================================================================
diff --git a/out/artifacts/Project_war_exploded/WEB-INF/classes/db.properties b/out/artifacts/Project_war_exploded/WEB-INF/classes/db.properties
deleted file mode 100644
--- a/out/artifacts/Project_war_exploded/WEB-INF/classes/db.properties	
+++ /dev/null	
@@ -1,4 +0,0 @@
-jdbc_driver = com.mysql.cj.jdbc.Driver
-db_url = jdbc:mysql://localhost:3306/User_information?useSSL=false&serverTimezone=GMT
-db_name = root
-db_pwd = 12345678
Index: src/test/java/com/group28/dao/TestElectricityUnitDao.java
===================================================================
diff --git a/src/test/java/com/group28/dao/TestElectricityUnitDao.java b/src/test/java/com/group28/dao/TestElectricityUnitDao.java
deleted file mode 100644
--- a/src/test/java/com/group28/dao/TestElectricityUnitDao.java	
+++ /dev/null	
@@ -1,104 +0,0 @@
-package com.group28.dao;
-
-import com.group28.pojo.ElectricityUnit;
-import com.group28.pojo.ElectricityUnitType;
-import com.group28.pojo.ZipCode;
-import com.group28.util.MyBatisUtil;
-import org.apache.ibatis.session.SqlSession;
-import org.junit.Test;
-
-import java.util.List;
-
-
-public class TestElectricityUnitDao {
-    @Test
-    public void searchElectricityUnitTest(){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-        ElectricityUnitDao mapper = sqlsession.getMapper(ElectricityUnitDao.class);
-        List<ElectricityUnit> euList = mapper.getElectricityUnit();
-        for (ElectricityUnit eu : euList) {
-            System.out.println(eu);
-        }
-        sqlsession.close();
-    }
-
-    @Test
-    public void AddTypeTest(){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlsession.getMapper(FacilityDao.class);
-
-        ElectricityUnitType NewType = new ElectricityUnitType();
-
-        NewType.PutTypeId("PB9");
-
-        NewType.PutMAX_CONSUMMPTION(200);
-
-        NewType.PutMIN_CONSUMMPTION(100);
-
-        mapper.AddType(NewType);
-
-        sqlsession.commit();
-
-        System.out.println(NewType);
-    }
-
-    @Test
-    public void AddUnitTest(){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-
-        FacilityDao mapper = sqlsession.getMapper(FacilityDao.class);
-
-        String ElectricityUnitID = "PB9S1A01";
-
-        String PlaceName = "CYY's House";
-
-        ElectricityUnit NewUnit = new ElectricityUnit();
-
-        NewUnit.Put_electricityUnitId(ElectricityUnitID);
-        NewUnit.Put_zipCode("S1 A01");
-        NewUnit.Put_electricityUnitType("PB9");
-        NewUnit.Put_electricityUnitName(PlaceName);
-
-        mapper.AddFacility(NewUnit);
-
-        sqlsession.commit();
-        sqlsession.close();
-
-
-    }
-
-    @Test
-    public void TestFacilitySearch_AddType(){
-        FacilitySearch SearchTest1 = new FacilitySearch();
-
-        SearchTest1.AddType("PB1", 100, 200);
-        SearchTest1.AddType("SP1", 1000, 500);
-    }
-
-    @Test
-    public void TestFacilitySearch_AddUnit(){
-        FacilitySearch SearchTest_AddUnit = new FacilitySearch();
-
-        SearchTest_AddUnit.AddUnit("PB9S1A01", "S9 G86", "SP2", "Qyh's House");
-        SearchTest_AddUnit.AddUnit("SP1S1A02", "S9 G86", "SP2", "Qyh's House");
-        SearchTest_AddUnit.AddUnit("SP1S1A02", "S1 A02", "SP2", "Qyh's House");
-        SearchTest_AddUnit.AddUnit("SP1S1A02", "S1 A02", "SP1", "Qyh's House");
-    }
-
-    @Test
-    public void TestDeleteUnit(){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlSession.getMapper(FacilityDao.class);
-
-        mapper.DeleteElectricityUnit("SP1S1A02");
-
-        sqlSession.commit();
-
-        mapper.DeleteElectricityType("SP1");
-
-        sqlSession.commit();
-
-        sqlSession.close();
-    }
-
-}
\ No newline at end of file
Index: src/main/java/com/group28/pojo/addNewFacilityImpl.java
===================================================================
diff --git a/src/main/java/com/group28/pojo/addNewFacilityImpl.java b/src/main/java/com/group28/pojo/addNewFacilityImpl.java
deleted file mode 100644
--- a/src/main/java/com/group28/pojo/addNewFacilityImpl.java	
+++ /dev/null	
@@ -1,45 +0,0 @@
-package com.group28.pojo;
-
-import com.group28.dao.FacilityDao;
-import com.group28.dao.UserDao;
-import com.group28.util.MyBatisUtil;
-import org.apache.ibatis.session.SqlSession;
-/**
- *
- * @author Yuyuan Cao
- * @version 1.1
- */
-
-public class addNewFacilityImpl implements addNewFacility{
-
-    public String addFacility(String facilityId,String type_Id,String facilityName,String x,String y){
-        NewFacility facility = new NewFacility();
-
-        //location to zipcode
-        String zipCode = "S" + x +" " + "A" + y;
-
-        ZipCode fac = facility.searchFacility(zipCode);
-
-
-        if(zipCode.equals(fac.getZipCode())){
-            return "Not addable";
-
-        }else{
-            SqlSession sqlSession = MyBatisUtil.getSqlSession();
-            FacilityDao mapper = sqlSession.getMapper(FacilityDao.class);
-            int maxint = mapper.GetMaxConsumption(type_Id);
-            FacilityDao mapper2 = sqlSession.getMapper(FacilityDao.class);
-            int minint = mapper2.GetMinConsumption(type_Id);
-            sqlSession.close();
-            Long max = new Long(maxint);
-            Long min = new Long(minint);
-            FacilityType facilityType = new FacilityType(type_Id,max,min);
-            NewFacility newOne = new NewFacility();
-            String block_name = "G5 2828 block";
-            ZipCode newZip = new ZipCode(zipCode,block_name);
-            newOne.FacilityAdd(facilityId,newZip,facilityType,facilityName);
-            return "Right";
-        }
-    }
-
-}
Index: src/main/java/com/group28/pojo/NewFacility.java
===================================================================
diff --git a/src/main/java/com/group28/pojo/NewFacility.java b/src/main/java/com/group28/pojo/NewFacility.java
deleted file mode 100644
--- a/src/main/java/com/group28/pojo/NewFacility.java	
+++ /dev/null	
@@ -1,61 +0,0 @@
-package com.group28.pojo;
-
-import com.group28.dao.FacilityDao;
-import com.group28.dao.PowerStationDao;
-import com.group28.dao.ZipCodeDao;
-import com.group28.util.MyBatisUtil;
-import org.apache.ibatis.session.SqlSession;
-
-import java.util.List;
-/**
- *
- * @author Yuyuan Cao
- * @version 1.1
- */
-public class NewFacility {
-    public ZipCode searchFacility(String zipCode){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        ZipCodeDao mapper = sqlSession.getMapper(ZipCodeDao.class);
-        ZipCode facilityZip = mapper.getZipCode(zipCode);
-        sqlSession.close();
-        return facilityZip;
-    }
-
-    public List<ZipCode> GetZipCodeList() {
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        ZipCodeDao mapper = sqlSession.getMapper(ZipCodeDao.class);
-
-        List<ZipCode> ZipCodeList = mapper.getZipCodeList();
-
-        sqlSession.close();
-        return  ZipCodeList;
-    }
-
-    public void FacilityAdd(String facilityId,ZipCode zipCode, FacilityType facilityType, String facilityName){
-
-        if(facilityType.getType_Id().length()==3){
-            SqlSession sqlSession = MyBatisUtil.getSqlSession();
-            FacilityDao mapper = sqlSession.getMapper(FacilityDao.class);
-            ElectricityUnitType electricityUnitType = new ElectricityUnitType(facilityType.getType_Id(), facilityType.getMAX_NUMERICAL(),facilityType.getMIN_NUMERICAL());
-            ElectricityUnit newEle = new ElectricityUnit(zipCode, electricityUnitType, facilityId,facilityName);
-            mapper.AddFacility(newEle);
-            sqlSession.commit();
-            System.out.println("Data inserted");
-            System.out.println("New Facility:" + newEle);
-        }else{
-            SqlSession sqlSession2 = MyBatisUtil.getSqlSession();
-            PowerStationDao mapper2 = sqlSession2.getMapper(PowerStationDao.class);
-
-            PowerStationType powerStationType = new PowerStationType(facilityType.getType_Id(), facilityType.getMAX_NUMERICAL());
-            PowerStation newPow = new PowerStation(zipCode, powerStationType, facilityId,facilityName);
-
-            mapper2.AddStation(newPow);
-            sqlSession2.commit();
-            System.out.println("Data inserted");
-            System.out.println("New Facility:" + newPow);
-        }
-
-    }
-
-
-}
Index: src/main/java/com/group28/dao/FacilitySearch.java
===================================================================
diff --git a/src/main/java/com/group28/dao/FacilitySearch.java b/src/main/java/com/group28/dao/FacilitySearch.java
deleted file mode 100644
--- a/src/main/java/com/group28/dao/FacilitySearch.java	
+++ /dev/null	
@@ -1,181 +0,0 @@
-package com.group28.dao;
-
-import com.group28.pojo.ElectricityUnit;
-import com.group28.pojo.ElectricityUnitType;
-import com.group28.pojo.PowerStation;
-import com.group28.pojo.PowerStationType;
-import com.group28.util.MyBatisUtil;
-import org.apache.ibatis.session.SqlSession;
-import java.util.List;
-
-public class FacilitySearch {
-    public void AddType(String type_Id, int MAX_CONSUMMPTION, int MIN_CONSUMMPTION){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlsession.getMapper(FacilityDao.class);
-
-        List<String> TypeList = mapper.GetTypeIdList();
-
-        ElectricityUnitType NewType = new ElectricityUnitType();
-
-        NewType.PutTypeId(type_Id);
-
-        NewType.PutMAX_CONSUMMPTION(MAX_CONSUMMPTION);
-
-        NewType.PutMIN_CONSUMMPTION(MIN_CONSUMMPTION);
-
-        if(!(TypeList.contains(type_Id))){
-            mapper.AddType(NewType);
-            sqlsession.commit();
-            System.out.println("New Type is:" + NewType);
-        }
-        else {
-            System.out.println("Add Fail, break the primary key.");
-        }
-        sqlsession.close();
-    }
-
-    public void AddUnit(String electricityUnitId, String zipCode, String electricityUnitType, String electricityUnitName){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlsession.getMapper(FacilityDao.class);
-        ZipCodeDao ZipMapper = sqlsession.getMapper(ZipCodeDao.class);
-
-        List<String> ZipCodeList = ZipMapper.getZipCode_CodeList();
-        List<String> TypeList = mapper.GetTypeIdList();
-        List<String> UnitList = mapper.GetUnitIdList();
-
-        if (ZipCodeList.contains(zipCode) && TypeList.contains(electricityUnitType) && !(UnitList.contains(electricityUnitId))){
-            ElectricityUnit NewUnit = new ElectricityUnit();
-
-            NewUnit.Put_electricityUnitName(electricityUnitName);
-            NewUnit.Put_electricityUnitId(electricityUnitId);
-            NewUnit.Put_electricityUnitType(electricityUnitType);
-            NewUnit.Put_zipCode(zipCode);
-
-            mapper.AddFacility(NewUnit);
-            sqlsession.commit();
-            System.out.println("New Unit is" + NewUnit);
-        }
-        else {
-            System.out.println("Add fail, break the foreign key rule or primary key rule");
-        }
-
-        sqlsession.close();
-    }
-
-    public void AddStationType(String type_Id, int MAX_PRODUCTION){
-        SqlSession sqlsession = MyBatisUtil.getSqlSession();
-        PowerStationDao mapper = sqlsession.getMapper(PowerStationDao.class);
-
-        List<String> TypeList = mapper.GetStationType_List();
-
-        if (!(TypeList.contains(type_Id))){
-            PowerStationType NewType = new PowerStationType();
-            NewType.Put_type_Id(type_Id);
-            NewType.Put_MAX_PRODUCTION(MAX_PRODUCTION);
-
-            mapper.AddStationType(NewType);
-            sqlsession.commit();
-        }
-        else {
-            System.out.println("Type already existed");
-        }
-
-
-        sqlsession.close();
-        System.out.println("Add Finish");
-    }
-
-    public void AddStation(String powerStationId, String zipCode, String powerStationType, String powerStationName){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        PowerStationDao mapper = sqlSession.getMapper(PowerStationDao.class);
-        ZipCodeDao ZipMapper = sqlSession.getMapper(ZipCodeDao.class);
-
-        List<String> ZipCodeList = ZipMapper.getZipCode_CodeList();
-        List<String> StationIDList = mapper.GetStationList();
-        List<String> TypeList = mapper.GetStationType_List();
-
-        if (ZipCodeList.contains(zipCode) && !(StationIDList.contains(powerStationId)) && TypeList.contains(powerStationType)){
-            PowerStation NewStation = new PowerStation();
-
-            NewStation.Put_powerStationId(powerStationId);
-            NewStation.Put_zipCode(zipCode);
-            NewStation.Put_powerStationType(powerStationType);
-            NewStation.Put_powerStationName(powerStationName);
-
-            mapper.AddStation(NewStation);
-            sqlSession.commit();
-        }
-        else {
-            System.out.println("Add fail, station already exist or invalid zipcode and type");
-        }
-        sqlSession.close();
-
-        System.out.println("add finish");
-
-
-    }
-
-
-
-    public int GetUnitMaxConsumption(String electricityUnitId){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlSession.getMapper(FacilityDao.class);
-        int MaxConsumption;
-        List<String> UnitList = mapper.GetUnitIdList();
-        if (UnitList.contains(electricityUnitId)){
-            String UnitType = mapper.GetTypeId(electricityUnitId);
-            MaxConsumption = mapper.GetMaxConsumption(UnitType);
-            sqlSession.close();
-            return MaxConsumption;
-        }
-        else{
-            sqlSession.close();
-            return -1;
-        }
-
-    }
-
-    public int GetMinUnitConsumption(String electricityUnitId){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        FacilityDao mapper = sqlSession.getMapper(FacilityDao.class);
-
-        int MinConsumption;
-        List<String> UnitList = mapper.GetUnitIdList();
-
-        if (UnitList.contains(electricityUnitId)){
-            String UnitType = mapper.GetTypeId(electricityUnitId);
-            MinConsumption = mapper.GetMinConsumption(UnitType);
-            sqlSession.close();
-            return MinConsumption;
-        }
-        else{
-            sqlSession.close();
-            return -1;
-        }
-    }
-
-
-    public int GetMaxProduction(String powerStationId){
-        SqlSession sqlSession = MyBatisUtil.getSqlSession();
-        PowerStationDao mapper = sqlSession.getMapper(PowerStationDao.class);
-
-        int Max_Production;
-        List<String> StationList = mapper.GetStationList();
-
-        if (StationList.contains(powerStationId)){
-            String StationType = mapper.GetType(powerStationId);
-            Max_Production = mapper.GetProduction(StationType);
-            sqlSession.close();
-            return Max_Production;
-        }
-        else {
-            sqlSession.close();
-            return  -1;
-        }
-    }
-
-
-
-
-    
-}
